name: Build Libretro Core

on:
  push:
    branches: [ main, libretro-core-implementation ]
  pull_request:
    branches: [ main ]

jobs:
  build-ios:
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Set up Xcode
        run: sudo xcode-select -s /Applications/Xcode_16.1.app

      - name: Build Core
        run: |
          make -f Makefile.libretro platform=ios -j$(sysctl -n hw.ncpu)

      - name: Verify Binary
        run: |
          file cytrus_ir_libretro_ios.dylib
          otool -l cytrus_ir_libretro_ios.dylib | grep -A 10 LC_BUILD_VERSION

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: cytrus_ir_libretro_ios
          path: cytrus_ir_libretro_ios.dylib
